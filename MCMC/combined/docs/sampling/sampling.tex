\documentclass{article}
\usepackage{algorithmic}
\usepackage{algorithm}
\usepackage{amsmath}
\usepackage[T1]{fontenc}

\begin{document}

\section{Sampling for Mass, Age and Feh}

Let $\phi_k$ and $m_k$ be the present state and its respective multiplitcity in the chain of n samples. Let $\sigma_{\phi}$ be the proposed step size. 

\begin{enumerate}
\item The mulitplicity for each sample point is thus modified as:

$$m_i^{\prime} = m_i  \dfrac{\exp \left[ -\left(\frac{\phi_k - \phi_i}{\sigma_{\phi}}\right)^2 \right]}{N}$$

where $N$ is a normalization factor given by:

$$N = \sum_{i=1}^n m_i  \exp \left[ -\left(\frac{\phi_k - \phi_i}{\sigma_{\phi}}\right)^2 \right]$$

\item The sampling parameters will then be modified as:

$$\phi_i^{\prime} = \phi_i \times m^{\prime}$$

\item Pick a random sample using following algorithm
\begin{algorithm}
\caption{Random Sampling}
\algsetup{indent=4em}
\begin{algorithmic} 
\STATE $U \rightarrow U(0,1)$
\FOR{$i=1$ to $n$}
	\IF {$m_i^{\prime} < U$}
		\RETURN $\phi_i^{\prime}$
	\ELSE \STATE  $U=U-m_i^{\prime}$
\ENDIF
\ENDFOR

\end{algorithmic}
\end{algorithm}

where U is a random number between 0 and 1.
\end{enumerate}

\newpage
\section{Acceptance Ratio}


$$R= \dfrac{P(D | \theta^{N+1},\phi^{N+1})}{P(D | \theta^{N},\phi^{N})}   \frac{\Pi(\theta^{N+1})}{ \Pi(\theta^{N})}   \frac{\Pi(\phi^{N+1})}{ \Pi(\theta^{N})} \frac{S(\theta^N | \theta^{N+1})}{S(\theta^{N+1} | \theta^{N})} \frac{S(\phi^N | \phi^{N+1})}{S(\phi^{N+1} | \phi^{N})}$$

where
\begin{itemize}
\item N is the current state of the system
\item $P(D | \theta, \phi)$ is the probability distribution of data given model.
\item $\Pi(\theta)$ and $\Pi(\phi)$ are the prior distributions.

\item $S(\theta^N,\theta^{N+1})$ and $S(\phi^N,\phi^{N+1})$  are transition probabilities for $\theta$ and $\phi$ respectively.
\end{itemize}

Using:
$$\Pi(\phi^N) = m_N / \sum_{i=1}^n m_N$$
$$S(\phi^N | \phi^{N+1}) =\dfrac{ m_N   e^{  -\left(\tfrac{\phi^N - \phi^{N+1}}{\sqrt{2}\sigma_{\phi}}\right)^2     }}{\sum_i^{n} m_i e^{  -\left(\tfrac{\phi^N - \phi^{i}}{\sqrt{2}\sigma_{\phi}}\right)^2}}$$.
$$S(\theta^N | \theta^{N+1}) = S(\theta^{N+1} | \theta^{N})$$ 

The acceptance ratio reduces to:
\[
\boxed{
R= \dfrac{P(D | \theta^{N+1},\phi^{N+1})}{P(D | \theta^{N},\phi^{N})}   \dfrac{\Pi(\theta^{N+1})}{ \Pi(\theta^{N})} \dfrac{\sum_{i=1}^{n} m_i \exp \left[  -\left(\tfrac{\phi^N - \phi^{i}}{\sqrt{2}\sigma_{\phi}}\right)^2 \right] } {\sum_{i=1}^{n} m_i \exp \left[  -\left(\tfrac{\phi^{N+1} - \phi^i}{\sqrt{2}\sigma_{\phi}}\right)^2 \right]}
}
\]




\end{document}
